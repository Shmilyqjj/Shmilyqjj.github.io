<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- 这个head中的属性会影响全局的，比如全局变色可以在这修改，下面是例子： -->
  <style type="text/css"> html {FILTER: grayscale(0)}</style>   <!-- 2020.4.4新冠病毒默哀日 调节网页为灰色  灰度设置 百分比 0-100  -->
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
  
  <title itemprop="name">CentOS7安装CDH6安装与排坑 | 佳境的小本本</title>
  
    <link rel="shortcut icon" href="/images/favicon.ico">
  
  <meta http-equiv="x-dns-prefetch-control" content="on">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Noto+SerifMerriweather|Merriweather+Sans|Source+Code+Pro|Ubuntu:400,700|Noto+Serif+SC" media="all">
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="stylesheet" id="saukra_css-css" href="/css/style.css" type="text/css" media="all">
  <link rel="stylesheet" href="/css/lib.min.css" media="all">
  <link rel="stylesheet" href="/css/font.css" media="all">
  <link rel="stylesheet" href="/css/insight.css" media="all">
  <link rel="stylesheet" href="/css/jquery.fancybox.min.css" media="all">
  <link rel="stylesheet" href="/css/zoom.css" media="all">
  <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<!--   <link rel="stylesheet" id="saukra_css-css" href="https://2heng.xin/wp-content/cache/autoptimize/css/autoptimize_ad42a61f4c7d4bdd9f91afcff6b5dda5.css
" type="text/css" media="all"> -->
  <script>
  /*Initial Variables*/
  var mashiro_option = new Object();
  var mashiro_global = new Object();
  mashiro_option.NProgressON = true;
  /* 
   * 邮箱信息之类的东西可以填在这里，这些js变量基本都作用于sakura-app.js
   * 这样的设置仅是为了方便在基于PHP开发的主题中设置js变量，既然移植到了Node上，我想或许可以精简这一逻辑吧
   */
  mashiro_option.email_domain = "";
  mashiro_option.email_name = "";
  mashiro_option.cookie_version_control = "";
  mashiro_option.qzone_autocomplete = false;
  mashiro_option.site_name = "佳境Shmily";
  mashiro_option.author_name = "Shmily";
  mashiro_option.site_url = "shmily-qjj.top";
  mashiro_option.v_appId = "zUyVEaHo59RUUwiPTChPEeBj-gzGzoHsz";
  mashiro_option.v_appKey = "xIEyTcrkTuJLz6ewPbpTj8mz";
  mashiro_option.mathjax = "0";
  mashiro_option.qq_api_url = "https://api.mashiro.top/qqinfo/"; 
  mashiro_option.qq_avatar_api_url = "https://api.mashiro.top/qqinfo/";

  // mashiro_option.jsdelivr_css_src = "https://cdn.jsdelivr.net/gh/moezx/cdn@3.4.5/css/lib.min.css";
  // mashiro_option.float_player_on = true;

  /*End of Initial Variables*/
  </script>
  <script type="text/javascript">
  var bg = "https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(0).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(9).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(10).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(11).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(18).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(21).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(22).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(23).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(26).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(27).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(28).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(29).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(30).webp,https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/cover/(31).webp".split(",");
  var bgindex = Math.floor(Math.random()*bg.length);
  if (!!window.ActiveXObject || "ActiveXObject" in window) { //is IE?
    alert('朋友，IE浏览器未适配哦~');
  }
  </script>
  <style type="text/css">
  .hljs-ln{border-collapse:collapse}.hljs-ln td{padding:0}.hljs-ln-n:before{content:attr(data-line-number)}
  </style>
  <style type="text/css">.site-top .lower nav{display:block !important;}.author-profile i,.post-like a,.post-share .show-share,.sub-text,.we-info a,span.sitename,.post-more i:hover,#pagination a:hover,.post-content a:hover,.float-content i:hover{color:#FE9600}.feature i,.download,.navigator i:hover,.links ul li:before,.ar-time i,span.ar-circle,.object,.comment .comment-reply-link,.siren-checkbox-radio:checked + .siren-checkbox-radioInput:after{background:#FE9600}::-webkit-scrollbar-thumb{background:#FE9600}.download,.navigator i:hover,.link-title,.links ul li:hover,#pagination a:hover,.comment-respond input[type='submit']:hover{border-color:#FE9600}.entry-content a:hover,.site-info a:hover,.comment h4 a,#comments-navi a.prev,#comments-navi a.next,.comment h4 a:hover,.site-top ul li a:hover,.entry-title a:hover,#archives-temp h3,span.page-numbers.current,.sorry li a:hover,.site-title a:hover,i.iconfont.js-toggle-search.iconsearch:hover,.comment-respond input[type='submit']:hover{color:#FE9600}.comments .comments-main{display:block !important;}.comments .comments-hidden{display:none !important;}background-position:center center;background-attachment:inherit;}
  </style>
<meta name="generator" content="Hexo 5.1.1"></head>

<body class="page-template page-template-user page-template-page-analytics page-template-userpage-analytics-php page page-id-1297 chinese-font serif isWebKit">
  <div class="scrollbar" id="bar">
  </div>
  <a href="#" class="cd-top faa-float animated"></a>
  <section id="main-container">
    <div class="headertop filter-dot">
  <div id="banner_wave_1"></div>
  <div id="banner_wave_2"></div>
  <figure id="centerbg" class="centerbg">
    <div class="focusinfo no-select">
      <div class="header-tou">
        <a href="shmily-qjj.top">
          <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/custom/avatar.jpg">
        </a>
      </div>
      <div class="header-info">
        <p>记得每天要早睡呀！</p>
        <div class="top-social_v2">
          <li id="bg-pre">
            <img class="flipx" src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/other/next-b.svg">
          </li>
          
            
              
                <li>
                  <a href="https://github.com/Shmilyqjj" target="_blank" class="social-github" title="github">
                    <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/social/github.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://music.163.com/artist?id=13610347&amp;userid=318926152" target="_blank" class="social-github" title="CloudMusic">
                    <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/social/wangyiyun.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="https://space.bilibili.com/55921513" target="_blank" class="social-github" title="bilibili">
                    <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/social/bilibili.png">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="mailto:710552907@qq.com?subject=test&amp;cc=sample@hotmail.com&amp;body=use mailto sample" target="_blank" class="social-github" title="email">
                    <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/social/email.svg">
                  </a>
                </li>
              
            
              
                <li>
                  <a href="http://wpa.qq.com/msgrd?v=3&amp;uin=710552907&amp;site=qq&amp;menu=yes" target="_blank" class="social-github" title="qq">
                    <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/social/qq.png">
                  </a>
                </li>
              
            
              
                <li class="wechat">
                  <a href="/#">
                    <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/social/wechat.png">
                  </a>
                  <div class="wechatInner">
                    <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/custom/WeChat.jpg">
                  </div>
                </li>
              
            
          
          <li id="bg-next">
            <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/other/next-b.svg">
          </li>
        </div>
      </div>
    </div>
  </figure>
  <div id="video-container" style="">
    <video style="object-fit: fill" id="bgvideo" class="video" video-name="" src="" width="auto" preload="auto">
    </video>
    <div id="video-btn" class="loadvideo videolive">
    </div>
    <div id="video-add">
    </div>
    <div class="video-stu">
    </div>
  </div>
  <div class="headertop-down faa-float animated" onclick="headertop_down()">
    <span>
      <i class="fa fa-chevron-down" aria-hidden="true">
      </i>
    </span>
  </div>
</div>
    <div id="page" class="site wrapper">
      <header class="site-header no-select gizle sabit" role="banner">
  <div class="site-top">
    <div class="site-branding">
      <span class="site-title">
        <span class="logolink moe-mashiro">
          <a href="/">
            <span class="sakurasono">佳境</span>
            <span class="shironeko">Shmily</span>
          </a>
        </span>
      </span>
    </div>
    <div class="searchbox search-form-submit">
      <i class="iconfont js-toggle-search iconsearch icon-search">
      </i>
    </div>
    <div id="show-nav" class="showNav mobile-fit">
      <div class="line line1">
      </div>
      <div class="line line2">
      </div>
      <div class="line line3">
      </div>
    </div>
    <div class="lower-cantiner">
      <div class="lower">
        <nav class="mobile-fit-control hide">
          <ul id="menu-new" class="menu">
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
                    首页
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/archives">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
                    归档
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/categories/%E6%8A%80%E6%9C%AF/">
                          <i class="fa fa-code" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E7%94%9F%E6%B4%BB/">
                          <i class="fa fa-file-text-o" aria-hidden="true"></i>
                          生活
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E9%9F%B3%E4%B9%90/">
                          <i class="fa fa-music" aria-hidden="true"></i>
                          音乐
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E9%9A%8F%E6%83%B3/">
                          <i class="fa fa-commenting-o" aria-hidden="true"></i>
                          随想
                        </a>
                      </li>
                    
                      <li>
                        <a href="/categories/%E5%85%B6%E4%BB%96/">
                          <i class="fa fa-book" aria-hidden="true"></i>
                          其他
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="javascript:;">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
                    清单
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/bangumi/">
                          <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                          看剧
                        </a>
                      </li>
                    
                      <li>
                        <a href="/tags/">
                          <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                          书单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/music/">
                          <i class="fa fa-headphones" aria-hidden="true"></i>
                          歌单
                        </a>
                      </li>
                    
                      <li>
                        <a href="/album/">
                          <i class="fa fa-photo" aria-hidden="true"></i>
                          相册
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/comment/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
                    留言板
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/links/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
                    博友圈
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/donate/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
                    赞赏
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
                    关于
                  </span>
                </a>
                
                  <ul class="sub-menu">
                    
                      <li>
                        <a href="/about/">
                          <i class="fa fa-meetup" aria-hidden="true"></i>
                          我？
                        </a>
                      </li>
                    
                      <li>
                        <a target="_blank" rel="noopener" href="https://tech.shmily-qjj.top/">
                          <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                          技术
                        </a>
                      </li>
                    
                      <li>
                        <a href="/lab/">
                          <i class="fa fa-cogs" aria-hidden="true"></i>
                          Lab
                        </a>
                      </li>
                    
                  </ul>
                
              </li>
            
              <li>
                <a href="/client/">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-android faa-vertical" aria-hidden="true"></i>
                    客户端
                  </span>
                </a>
                
              </li>
            
              <li>
                <a href="/atom.xml">
                  <span class="faa-parent animated-hover">
                    <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
                    RSS
                  </span>
                </a>
                
              </li>
            
          </ul>
        </nav>
      </div>
    </div>
  </div>
</header>

      <link rel="stylesheet" type="text/css" href="/css/sharejs.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
<div class="pattern-center-blank"></div>

<!-- 屏蔽F12查看文章内容+避免图片被拖拽保存 -->

  <script language="Javascript">
    document.onkeydown=function (e){
      var currKey=0,evt=e||window.event;
      currKey=evt.keyCode||evt.which||evt.charCode;
      if (currKey >111 && currKey < 124) {
        window.event.cancelBubble = true;
        window.event.returnValue = false;
      }
    }
    for (i in document.images) document.images[i].ondragstart = imgdragstart;
    function imgdragstart() {
      return false;
    }
  </script>


<!-- 实现文章的notshow和nocopy属性，支持模糊、屏蔽文章内容，禁止复制功能 -->

  <!-- 对于未指定notshow属性或未指定nocopy属性的 或为false的，恢复可复制可选择权限 -->
  <script language="Javascript">
    document.oncontextmenu="";
    document.onselectstart=true;
  </script>
  


  <div class="pattern-center single-center">
    <!-- 有配图默认渲染第一张 -->
    <div class="pattern-attachment-img lazyload" style="background-image: url(https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-intro.jpg);" src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-intro.jpg">
    </div>
    <header class="pattern-header single-header">
      <h1 class="entry-title">
      CentOS7安装CDH6安装与排坑</h1>
      <p class="entry-census">
        <span>
          <a href="/">
            <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/custom/avatar.jpg">
          </a>
        </span>
        <span>
          <a href="/">佳境</a>
        </span>
        <span class="bull">
        ·</span>
        2019-10-29<span class="bull">
        ·</span>
      <span id="busuanzi_value_page_pv"></span>次阅读</p>
    </header>
  </div>

<div id="content" class="site-content">
  <div id="primary" class="content-area">
    <main id="main" class="site-main" role="main">
      <article id="post-1" class="post-1 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">
        <div class="toc"></div>
        <!--<div class="toc-entry-content"><!-- 套嵌目录使用（主要为了支援评论）-->
        
        <div class="entry-content">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>一开始搭集群时，都是装Apache原生的Hadoop，Spark包，一个一个装，一个一个配，好麻烦，而且通过命令或REST监控还很不直观，直到我遇到了Cloudera Manager，这东西简直就是神器。<br><a target="_blank" rel="noopener" href="https://www.cloudera.com/products/product-components/cloudera-manager.html">Cloudera Manager</a>（简称CM），是Cloudera开发的一款大数据集群部署神器，而且它具有集群自动化安装、中心化管理、集群监控、报警等功能，通过它，可以轻松一键部署，大大方便了运维，也极大的提高集群管理的效率。<br>一开始因为CentOS8出来了，想尝鲜，发现ClouderaManager没有el8的版本，所以暂时还不能用CentOS8来安装CM，请千万不要尝试使用CentOS8。  </p>
<p>CM的主要功能：</p>
<ol>
<li>管理：对集群进行管理，如添加、删除节点等操作</li>
<li>监控：监控集群的健康情况，对设置的各种指标和系统运行情况进行全面监控</li>
<li>诊断：对集群出现的问题进行诊断，会针对集群问题给出建议的方案</li>
<li>集成：对hadoop生态的多种组件和框架进行整合，减少部署时间和工作量</li>
<li>兼容：与各个生态圈的兼容性强</li>
</ol>
<p>总结一下就是：方便搭建和运维，提供全面监控</p>
<h2 id="CDH架构"><a href="#CDH架构" class="headerlink" title="CDH架构"></a>CDH架构</h2><p><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-01.jpg" alt="alt CDH-01"><br>CDH的组件：</p>
<ul>
<li>Agent：在每台机器上安装，该代理程序负责启动和停止服务和角色的过程，拆包配置，触发装置和监控主机。</li>
<li>Management Service：负责执行各种监控，警报和报告功能角色等服务。</li>
<li>Database：存储配置和监视信息。通常情况下，多个逻辑数据库在一个或多个数据库服务器上运行。例如，Cloudera的管理服务器和监控角色使用不同的逻辑数据库。</li>
<li>Cloudera Repository：软件由Cloudera管理分布存储库。</li>
<li>Clients：是用于与服务器进行交互的接口</li>
</ul>
<p><strong>CDH中都有哪些服务?</strong> </p>
<table>
<thead>
<tr>
<th>组件名称</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>Zookeeper</td>
<td>Apache ZooKeeper 是用于维护和同步配置数据的集中服务。</td>
</tr>
<tr>
<td>HDFS</td>
<td>HDFS是 Hadoop 应用程序使用的主要存储系统。</td>
</tr>
<tr>
<td>yarn</td>
<td>Apache Hadoop MapReduce 2.0 (MRv2) 或 YARN 是支持 MapReduce 应用程序的数据计算框架。依赖HDFS服务。</td>
</tr>
<tr>
<td>HBase</td>
<td>支持随机读/写访问的Hadoop数据库(HBase是一个分布式、面向列的开源数据库，)</td>
</tr>
<tr>
<td>Hive</td>
<td>在大数据集合上的类SQL查询和表。Hive是基于Hadoop的一个数据仓库工具，可以将结构化的数据文件映射为一张数据库表，并提供简单的sql查询功能，可以将sql语句转换为MapReduce任务进行运行。</td>
</tr>
<tr>
<td>impala</td>
<td>Impala是一个新型查询系统，它提供SQL语义，能查询存储在Hadoop的HDFS和HBase中的PB级大数据。</td>
</tr>
<tr>
<td>solr</td>
<td>Solr是一个分布式服务，用于编制存储在 HDFS 中的数据的索引并搜索这些数据。</td>
</tr>
<tr>
<td>spark</td>
<td>Spark是强大的开源并行计算引擎，基于内存计算，速度更快；接口丰富，易于开发；集成SQL、Streaming、GraphX、MLlib，提供一栈式解决方案。</td>
</tr>
<tr>
<td>flume</td>
<td>高可靠、可配置的数据流集合。</td>
</tr>
<tr>
<td>storm</td>
<td>Storm是一个分布式的、容错的实时计算系统。</td>
</tr>
<tr>
<td>kafka</td>
<td>Kafka是一种高吞吐量的分布式发布订阅消息系统。</td>
</tr>
<tr>
<td>Hue</td>
<td>可视化Hadoop应用的用户接口框架和SDK。。</td>
</tr>
<tr>
<td>Sqoop</td>
<td>以高度可扩展的方式跨关系数据库和HDFS移动数据</td>
</tr>
<tr>
<td>oozie</td>
<td>Oozie是一种框架，是用于hadoop平台的作业调度服务。</td>
</tr>
<tr>
<td>Avro</td>
<td>数据序列化：丰富的数据结构，快速/紧凑的二进制格式和RPC。</td>
</tr>
<tr>
<td>Crunch</td>
<td>Java库，可以更轻松地编写，测试和运行MR管道。</td>
</tr>
<tr>
<td>DataFu</td>
<td>用于进行大规模分析的有用统计UDF库。</td>
</tr>
<tr>
<td>Mahout</td>
<td>用于群集，分类和协作过滤的库。</td>
</tr>
<tr>
<td>Parquet</td>
<td>在Hadoop中提供压缩，高效的列式数据表示。</td>
</tr>
<tr>
<td>Pig</td>
<td>提供使用高级语言批量分析大型数据集的框架。</td>
</tr>
<tr>
<td>MapReduce</td>
<td>强大的并行数据处理框架。</td>
</tr>
<tr>
<td>Pig</td>
<td>数据流语言和编译器</td>
</tr>
<tr>
<td>Sqoop</td>
<td>利用集成到Hadoop的数据库和数据仓库</td>
</tr>
<tr>
<td>Sentry</td>
<td>为Hadoop用户提供精细支持，基于角色的访问控制。</td>
</tr>
<tr>
<td>Kudu</td>
<td>完成Hadoop的存储层，以实现对快速数据的快速分析。</td>
</tr>
</tbody></table>
<h2 id="安装部署"><a href="#安装部署" class="headerlink" title="安装部署"></a>安装部署</h2><p>在虚拟机环境上部署Cloudera Manager，可能达不到预期的效果，但是基本的功能可以实现。<br>我的电脑内存16GB勉强可以使用，如果电脑16GB以上的可以考虑折腾CDH，16GB以下的想都不要想…</p>
<h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>物理机i7-6700hq 16GB内存 1T HDD<br>虚拟机四台 8个逻辑核心 内存分配分别是 5GB 3GB 2GB 2GB （可以说是榨干了物理机性能）<br>建议如果没有i7-8th及以上CPU或没有32G+的电脑，就不要尝试了。还是直接装Apache版的好些。<br>VMWare 15<br>SecureCRT 8.1.4<br>FileZilla 3.40.0<br>CentOS 7<br><font size="6" color="red"><strong>以上是旧配置，后面再有更新均使用新的配置：</strong></font><br>物理机i7-9750h 64GB内存 2T HDD+2T SSD<br>虚拟机四台 12个逻辑核心 内存分配分别是 20GB 14GB 14GB 10GB<br>Hyper-V虚拟机<br>SecureCRT 8.5.3<br>FileZilla 3.40.0<br>CentOS 7<br>能够同时运行所有服务。</p>
<h3 id="一-基础配置"><a href="#一-基础配置" class="headerlink" title="一.基础配置"></a>一.基础配置</h3><p><strong>下载CentOS7:</strong><br><a target="_blank" rel="noopener" href="http://mirrors.aliyun.com/centos/7.7.1908/isos/x86_64/CentOS-7-x86_64-Minimal-1908.iso">CentOS7 Minimal下载</a></p>
<p><strong>虚拟机配置</strong>  </p>
<ul>
<li><p>使用VMWare<br>采用NAT格式网卡,按如下配置<br>虚拟网卡设置（编辑-虚拟网络编辑器）<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-02.jpg" alt="alt CDH-02"><br>点击NAT设置:<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-02.5.jpg" alt="alt CDH-2.5"><br>点击DHCP设置:<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-03.jpg" alt="alt CDH-03"><br>以后我们的虚拟机都使用NAT网卡<br><strong>安装CentOS7</strong><br>文件-&gt;新建虚拟机-&gt;选择自定义(高级)-&gt;下一步-&gt;下一步-&gt;<strong>稍后安装操作系统</strong>-&gt;选择Linux/CentOS7 64位-&gt;下一步-&gt;虚拟机名称CDH066-&gt;下一步<br>-&gt;根据自己电脑设置核心数-&gt;下一步-&gt;虚拟机内存5120MB-&gt;网络类型选NAT-&gt;下一步…-&gt;磁盘分配80GB-&gt;下一步-&gt;下一步-&gt;自定义硬件-&gt;选择CentOS7的安装镜像,如图:<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-03.5.jpg" alt="alt CDH-03.5"><br>关闭-&gt;完成-&gt;开启此虚拟机<br>开始安装<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-04.jpg" alt="alt CDH-04"><br>安装Minimal版的CentOS，感觉很清爽！但是后续需要自己手动装一些依赖包，不过这样也好，可以避免安装过多无用的依赖。时区选择ShangHai。  </p>
<p>此步骤时指定root密码123456<br>安装时指定一个管理员用户shmily 密码123456<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-05.jpg" alt="alt CDH-05"><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-05.5.jpg" alt="alt CDH-05.5">  </p>
</li>
<li><p>使用Hyper-V（推荐）<br>在Hyper-V管理器中的虚拟交换机管理器新建内部网络，然后如果要指定IP，需要去电脑的网络设置IPV4，然后设置把Wifi网络共享给这个网卡。<br>IPV4：192.168.x.1  (x均替换为你喜欢的值 1-254)<br>网关255.255.255.255.0<br>然后配置虚拟机ifcfg-eth0时<br>IPADDR=192.168.x.101<br>NETMASK=255.255.255.0<br>DNS1=192.168.x.1<br>DNS2=192.168.x.2<br>……..<br>我的设置如图：<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-05.6.JPG" alt="alt CDH-05.6"><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-05.7.JPG" alt="alt CDH-05.7"><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-05.8.JPG" alt="alt CDH-05.8"><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-05.9.JPG" alt="alt CDH-05.9">  </p>
</li>
</ul>
<p>安装完成后Reboot，按步骤进行如下配置  </p>
<pre><code class="shell"> rm -rf * 

 vi /etc/sysconfig/network   
 NETWORKING=yes
 HOSTNAME=cdh066

 vi /etc/sysconfig/network-scripts/ifcfg-ens33  修改以下几项的值
 BOOTPROTO=static
 ONBOOT=yes
 NM_CONTROLLED=yes
 IPADDR=192.168.1.66
 GATEWAY=192.168.1.2
 DNS1=192.168.1.2

 vi /etc/sudoers  添加以下，必要的话可以加其他用户权限控制策略，这里我对root和shmily两个用户赋权
 root ALL=(ALL)  ALL 下面添加：
 shmily ALL=(ALL)  ALL

 systemctl start NetworkManger
 systemctl enable NetworkManger
 service NetworkManager status

 systemctl status firewalld.service    # 查看防火墙状态
 systemctl stop firewalld.service   # 关闭防火墙
 systemctl disable firewalld.service   # 关闭防火墙开机启动
 systemctl is-enabled firewalld.service  # 查看防火墙是否开机启动

 # 关闭selinux
 vi /etc/selinux/config 配置文件中的 SELINUX=disabled

 # 开启SSH服务，用于使用SecureCRT连接
 # 检查ssh服务是否开启（CentOS7默认开启）
 ps -e | grep sshd 

 # 修改Hostname
 vi /etc/hostname
 localhost.localdomain改为cdh066

 sudo hostnamectl set-hostname CDH067

 vi /etc/hosts  # 添加如下记录
 192.168.1.66 cdh066
 192.168.1.67 cdh067
 192.168.1.68 cdh068
 192.168.1.69 cdh069

 reboot   # 重启机器CDH066

 # 检查22端口是否开启 （CentOS87默认开启）
 yum install net-tools
 netstat -an | grep 22</code></pre>
<p>SecureCRT连接测试SSH<br>SecureCRT创建New Session -&gt; SSH2 -&gt; Hostname是CDH066 username是root<br>发现还是会提示Hostname lookup failed: host not found<br>需要修改Windows的C:\Windows\System32\drivers\etc\hosts<br>添加如下并保存<br>192.168.1.66 cdh066<br>192.168.1.67 cdh067<br>192.168.1.68 cdh068<br>192.168.1.69 cdh069</p>
<p>重新用SecureCRT连接出现如下图:<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-06.jpg" alt="alt CDH-06"><br>Accept &amp; Save,输入密码并勾选Save password<br>完成<br>FileZilla也能连接了:<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-07.jpg" alt="alt CDH-07">  </p>
<p>检查一下网络:<br>ping 8.8.8.8<br>能ping通即可进行下一步，如果ping不通，需要仔细检查网络配置文件:<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-08.jpg" alt="alt CDH-08">  </p>
<p>安装python:<br>CentOS7 Minimal默认带Python2.7.5版本，已经满足需求，为了开发方便，还是安装个ipython吧  </p>
<pre><code class="shell"> yum -y install epel-release
 yum install python-pip
 pip install -i https://pypi.tuna.tsinghua.edu.cn/simple --upgrade pip
 pip install -i https://pypi.tuna.tsinghua.edu.cn/simple requests  # 安装必要的库可以指定源 以安装requests库为例
 pip install -i https://pypi.tuna.tsinghua.edu.cn/simple ipython   # 安装ipython</code></pre>
<p>完成后，命令行执行python即可运行python2.7.5，命令行执行ipython即可使用ipython  </p>
<p>安装一些必要的常用命令[必要]<br>yum install bind-utils<br>yum -q install /usr/bin/iostat<br>yum install vim wget iotop lsof<br>yum install -y git<br>yum install dstat   (全面的系统监控工具-推荐)<br>yum install nload  </p>
<p>安装一些CDH所需的必要依赖[必要] </p>
<pre><code class="shell"> yum -y install chkconfig bind-utils psmisc libxslt zlib sqlite cyrus-sasl-plain cyrus-sasl-gssapi fuse portmap fuse-libs redhat-lsb httpd httpd-tools unzip ntp
 systemctl start httpd.service  # 启动httpd服务
 systemctl enable httpd.service # 设置httpd开机启动
 yum -y install httpd createrepo  # createrepo是安装CDH6集群必备

 vim /etc/rc.local  添加
 echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
 echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled

 chmod +x /etc/rc.d/rc.local</code></pre>
<p>安装JDK1.8[千万不要自行更换版本]<br>去Oracle官网下载1.8版本8u181的安装包<a target="_blank" rel="noopener" href="https://www.oracle.com/technetwork/java/javase/downloads/java-archive-javase8-2177648.html">JDK 1.8历史版本下载</a><br>如果安装最新版本，后续CDH安装服务会无法启动，遇到各种问题。<br>要明确CDH6.3支持的JDK版本：<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-25.JPG" alt="alt CDH-25">  </p>
<p>这里注意，JDK目录一定是/usr/java/jdk_1.8.x_xx，这样CM服务才能检测到JDK，否则服务无法启动  </p>
<pre><code class="shell"> mkdir /opt/software
 # 通过FileZilla上传到CDH066节点的 &lt;u&gt;/opt/software&lt;/u&gt;目录下  
 cd /opt/software
 mkdir /usr/java/
 tar -zxvf jdk-8u181-linux-x64.tar.gz -C /usr/java/
 cd ..
 vim /etc/profile 添加
#JAVA_HOME      
export JAVA_HOME=/usr/java/jdk1.8.0_181
export PATH=$JAVA_HOME/bin:$PATH
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar

 source /etc/profile
 java -version</code></pre>
<p>优化服务器配置</p>
<pre><code class="shell"># swappiness
echo 10 &gt; /proc/sys/vm/swappiness
# 关闭透明大页面压缩
echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
echo &quot;vm.swappiness=0&quot; &gt;&gt; /etc/sysctl.conf</code></pre>
<p>还有一些其他的监控命令<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_15766181/article/details/89928275">Linux监控命令汇总</a>  </p>
<p>Mysql安装(CDH必备)<br>首先查看Cloudera Manager官网要求的Mysql版本：<a target="_blank" rel="noopener" href="https://docs.cloudera.com/documentation/enterprise/6/release-notes/topics/rg_database_requirements.html#cdh_cm_supported_db">Database Requirements</a><br>参考CDH6.x兼容的版本，我们选择Mysql5.7版本<br>注意:<br>mysql-server依赖mysql-client<br>mysql-client依赖mysql-community-libs<br>mysql-community-libs依赖mysql-community-common<br>所以安装Server会默认安装其全部依赖<br>在线安装：</p>
<pre><code class="shell"> rpm -qa|grep mariadb
 rpm -e --nodeps mariadb-libs-5.5.64-1.el7.x86_64  # 卸载MariaDB 虽然CDH6支持了MariaDB，但还是推荐Mysql
 wget -i -c http://dev.mysql.com/get/mysql57-community-release-el7-10.noarch.rpm  
 yum -y install mysql57-community-release-el7-10.noarch.rpm
 yum -y install mysql-community-server</code></pre>
<p>离线安装：<br>去<a target="_blank" rel="noopener" href="https://downloads.mysql.com/archives/community/">Mysql-Archives</a> 下载对应版本的rpm包</p>
<pre><code class="shell"># 安装依赖包
rpm -ivh mysql-community-common-5.7.28-1.el7.x86_64.rpm
# 若安装失败 删除mariadb包
rpm -qa | grep mariadb
rpm -ve mariadb
# 安装libs
rpm -ivh mysql-community-libs-5.7.28-1.el7.x86_64.rpm 
# 安装客户端
rpm -ivh mysql-community-client-5.7.28-1.el7.x86_64.rpm 
# 安装服务端
rpm -ivh mysql-community-server-5.7.28-1.el7.x86_64.rpm 
# 启动
systemctl status mysqld 
# 开机自启
systemctl  enable mysqld
# 查找临时密码
grep &#39;temporary password&#39; /var/log/mysqld.log
# 设置密码强度
set global validate_password_policy=LOW;
set global validate_password_length=6;</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-08.6.jpg" alt="alt CDH-08.6"><br>如图安装完成，接着我们对其进行一些配置  </p>
<pre><code class="shell"> systemctl start mysqld.service
 systemctl enable mysqld.service  # 设置开机启动
 systemctl status mysqld.service # 查看mysql运行状态
 grep &#39;temporary password&#39; /var/log/mysqld.log  # 找到root初始密码，我的是cWgrI9:14%=_
 mysql -uroot -p           # 登陆mysql
 # 提示Enter Password
  cWgrI9:14%=_    
 set global validate_password_policy=LOW;    # 没有这项会提示Your password does not satisfy the current policy requirements  如果不是生产环境需要修改密码安全策略等级为LOW
 set global validate_password_length=6;   # 最低密码长度，因为测试所以设为了6 生产环境则不需要修改
 ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;123456&#39;; # 修改数据库密码为123456

 CREATE USER &#39;mysql&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;  # root登陆然后创建用户及其密码（用户名mysql为例）
 GRANT ALL ON mysql.* TO &#39;mysql&#39;@&#39;%&#39;;  # 赋予mysql用户所有权限
 flush privileges; # 刷新配置 
 status;  # 通过这个命令发现Mysql目前不是UTF-8字符集</code></pre>
<p>配置utf-8字符集<br>vim /etc/my.cnf  添加如下配置<br>注意顺序，client一定在mysqld属性的上方  </p>
<pre><code class="conf">[client]
default-character-set=utf8
[mysqld]
init_connect=&#39;SET collation_connection = utf8_unicode_ci&#39; 
init_connect=&#39;SET NAMES utf8&#39; 
character-set-server=utf8 
collation-server=utf8_unicode_ci 
skip-character-set-client-handshake</code></pre>
<p>根据<a target="_blank" rel="noopener" href="https://docs.cloudera.com/documentation/enterprise/6/latest/topics/cm_ig_mysql.html#cmig_topic_5_5">CDH官方推荐的Mysql参数配置</a>,继续添加如下参数:<br>如果生产环境，需要根据集群配置的实际情况来设定  </p>
<pre><code class="shell">[mysqld]
transaction-isolation = READ-COMMITTED
symbolic-links = 0

key_buffer_size = 32M
max_allowed_packet = 32M
thread_stack = 256K
thread_cache_size = 64
query_cache_limit = 8M
query_cache_size = 64M
query_cache_type = 1

max_connections = 550
expire_logs_days = 10
max_binlog_size = 100M
log_bin=/var/lib/mysql/mysql_binary_log
server_id=1
binlog_format = mixed

read_buffer_size = 2M
read_rnd_buffer_size = 16M
sort_buffer_size = 8M
join_buffer_size = 8M

# InnoDB settings
innodb_file_per_table = 1
innodb_flush_log_at_trx_commit  = 2
innodb_log_buffer_size = 64M
innodb_buffer_pool_size = 128M   
innodb_thread_concurrency = 8
innodb_flush_method = O_DIRECT
innodb_log_file_size = 512M
sql_mode=STRICT_ALL_TABLES

# disable_ssl
skip_ssl</code></pre>
<p>重启Mysql服务<br>systemctl restart mysqld.service</p>
<p>登录Mysql并查看是否修改成功<br>mysql -hlocalhost -P3306 -uroot  -p123456<br>show variables like “%character%”;<br>show variables like “%collation%”;<br>如图即为配置成功<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-09.jpg" alt="alt CDH-09">  </p>
<p>创建CM的数据库并增加数据库所属用户的远程登陆权限：  </p>
<pre><code class="shell">CREATE DATABASE scm DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE amon DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE rman DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE hue DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE hive DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE sentry DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE nav DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE navms DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;
CREATE DATABASE oozie DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_general_ci;

GRANT ALL ON scm.* TO &#39;scm&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON amon.* TO &#39;amon&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON rman.* TO &#39;rman&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON hue.* TO &#39;hue&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON hive.* TO &#39;hive&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON sentry.* TO &#39;sentry&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON nav.* TO &#39;nav&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON navms.* TO &#39;navms&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON oozie.* TO &#39;oozie&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;

GRANT ALL ON scm.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON amon.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON rman.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON hue.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON hive.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON sentry.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON nav.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON navms.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;
GRANT ALL ON oozie.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;

set global validate_password_policy=LOW; 
set global validate_password_length=6; 
GRANT ALL ON root.* TO &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;123456&#39;;  # 让root用户可以在cdh066节点上登录
FLUSH PRIVILEGES;
</code></pre>
<p>关于如何查看和修改用户的远程登录权限：<br>select user,host from mysql.user;<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-09.5.jpg" alt="alt CDH-09.5"><br>host字段为%的则是允许远程登录的用户，是localhost的只能本地登录<br>所以想给远程某台机器开通远程访问某个用户的权限： update mysql.user set host=’CDH066’ where user=’root’;<br>或者想给某个用户所有局域网内机器的访问权限： update mysql.user set host=’%’ where user=’root’;<br>然后重启服务或者刷新配置就可以通过mysql -hCDH066 -uroot -p123456来登录了<br>远程其他节点可以通过制定-h来访问非root用户的mysql<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-09.6.jpg" alt="alt CDH-09.6"> </p>
<p>Mysql JDBC库配置：<br>右键 链接另存为 进行下载<br>**<a target="_blank" rel="noopener" href="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/mysql-connector-java-5.1.47-bin.jar">下载mysql-connector-java-5.1.47-bin.jar</a>**，将mysql-connector-java-5.1.47-bin.jar文件上传到CDH066节点上的/usr/share/java/目录下并重命名为mysql-connector-java.jar（如果/usr/share/java/目录不存在，需要手动创建）  </p>
<p>系统文件描述符限制修改<br>vi /etc/security/limits.conf</p>
<pre><code class="text">* soft nofile 32728
* hard nofile 1029345
* soft nproc 65536
* hard nproc unlimited
* soft memlock unlimited
* hard memlock unlimited</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-10.jpg" alt="alt CDH-10">  </p>
<p>好玩的screenfetch(可选，用来娱乐…)  </p>
<pre><code class="bash"> cd /usr/local/src
 git clone https://github.com/KittyKatt/screenFetch.git
 cp screenFetch/screenfetch-dev /usr/local/bin/screenfetch
 chmod 777 /usr/local/bin/screenfetch</code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-11.jpg" alt="alt CDH-11">  </p>
<p>我的配置暂时这样，如果后续有什么需要改进我再更新。<br>更多安全与防火墙配置参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/thinktik/article/details/81046318">安全与防火墙配置</a><br>有关linux用户和组的详细文章:<a target="_blank" rel="noopener" href="https://www.cnblogs.com/pengyunjing/p/8543026.html">Linux用户和组</a>  </p>
<p>开启ntpd时间同步：参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/zx8167107/article/details/78753134">ntp本地服务器搭建</a><br>1.创建本地NTP时间服务器</p>
<pre><code class="text">vim /etc/ntp.conf
注释掉：
#restrict default nomodify notrap nopeer noquery
#restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap
#server 0.centos.pool.ntp.org iburst
#server 1.centos.pool.ntp.org iburst
#server 2.centos.pool.ntp.org iburst
#server 3.centos.pool.ntp.org iburst
添加：
restrict default nomodify
restrict 192.168.1.0 mask 255.255.255.0 nomodify   显式的指出时间服务器所涉及的ip范围
server 127.127.1.0
fudge 127.127.1.0 stratum 10</code></pre>
<p>2.配置NTP客户端（其他节点）</p>
<pre><code class="text">注释掉：
#restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap
#server 0.centos.pool.ntp.org iburst
#server 1.centos.pool.ntp.org iburst
#server 2.centos.pool.ntp.org iburst
#server 3.centos.pool.ntp.org iburst
添加：
server cdh101  指明本地ntp服务器地址</code></pre>
<p>3.分别启动ntpd服务<br>systemctl status ntpd<br>systemctl start ntpd<br>systemctl enable ntpd<br>ntpdate -u cdh101  手动同步一次<br>ntpq –p  查看ntpd服务状态</p>
<h3 id="二-克隆虚拟机"><a href="#二-克隆虚拟机" class="headerlink" title="二.克隆虚拟机"></a>二.克隆虚拟机</h3><p>克隆CDH所需的另外三台虚拟机<br>右键CDH066这台已关闭的虚拟机，右键-&gt;管理-&gt;克隆<br>选择虚拟机中当前状态  下一步<br>选择创建完整克隆  下一步<br>虚拟机名称 CDH067  完成<br>同样方法克隆 CDH068 CDH069<br>克隆完成对机器进行设置:<br>CDH067  3GB内存<br>CDH068  2GB内存<br>CDH069  2GB内存  </p>
<p>开启CDH067机器<br>确保 /ect/hosts里已经添加了其他机器的ip和host<br>vim /etc/sysconfig/network-scripts/ifcfg-ens33<br>删除UUID和HWADDR<br>IPADDR重新分配为192.168.1.67<br>修改后如图<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-12.jpg" alt="alt CDH-12">  </p>
<p>vi /etc/sysconfig/network<br>NETWORKING=yes<br>HOSTNAME=CDH067  </p>
<p>vi /etc/hostname<br>CDH066改为CDH067<br>sudo hostnamectl set-hostname CDH067</p>
<p>重启 reboot  </p>
<p>同样方式修改CDH068,CDH069  </p>
<p>检查：  </p>
<ol>
<li>ping8.8.8.8能通  </li>
<li>使用SecureCRT可以正常连接到机器  </li>
<li>ifconfig 或 ip addr命令查看ip地址成功改过来了<br>则配置成功  </li>
</ol>
<h3 id="三-配置免密登录"><a href="#三-配置免密登录" class="headerlink" title="三.配置免密登录"></a>三.配置免密登录</h3><p>在四台机器分别操作：<br>ssh-keygen  并连续敲三下回车</p>
<p>在66机器上<br>ssh-copy-id cdh066   建立 cdh066自身免密<br>ssh-copy-id cdh067   建立 cdh066 -&gt; cdh067单向免密<br>ssh-copy-id cdh068   建立 cdh066 -&gt; cdh068单向免密<br>ssh-copy-id cdh069   建立 cdh066 -&gt; cdh069单向免密  </p>
<p>在67机器上<br>ssh-copy-id cdh066   建立 cdh067 -&gt; cdh066单向免密<br>ssh-copy-id cdh067   建立 cdh066自身免密<br>ssh-copy-id cdh068   建立 cdh067 -&gt; cdh068单向免密<br>ssh-copy-id cdh069   建立 cdh067 -&gt; cdh069单向免密  </p>
<p>在68机器上<br>ssh-copy-id cdh066   建立 cdh068 -&gt; cdh066单向免密<br>ssh-copy-id cdh067   建立 cdh068 -&gt; cdh067单向免密<br>ssh-copy-id cdh068   建立 cdh068自身免密<br>ssh-copy-id cdh069   建立 cdh068 -&gt; cdh069单向免密  </p>
<p>在69机器上<br>ssh-copy-id cdh066   建立 cdh069 -&gt; cdh066单向免密<br>ssh-copy-id cdh067   建立 cdh069 -&gt; cdh067单向免密<br>ssh-copy-id cdh068   建立 cdh069 -&gt; cdh068单向免密<br>ssh-copy-id cdh069   建立 cdh069自身免密  </p>
<p>测试都能免密登录:<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-13.jpg" alt="alt CDH-13"><br>至此免密登录配置完成  </p>
<h3 id="四-CDH6安装"><a href="#四-CDH6安装" class="headerlink" title="四.CDH6安装"></a>四.CDH6安装</h3><p>下面的是下载地址，因为我之前手动安装了JDK1.8，所以可以不下载<u>oracle-j2sdk1.8-1.8.0+update181-1.x86_64.rpm</u>这个包，其余的包全部下载下来<br><a target="_blank" rel="noopener" href="https://archive.cloudera.com/cm6/6.3.1/redhat7/yum/RPMS/x86_64/">CDH6.3.1下载地址</a><br>还需要一个asc文件，下载地址：<a target="_blank" rel="noopener" href="https://archive.cloudera.com/cm6/6.3.1/allkeys.asc">allkeys.asc</a>,右键另存为即可<br><strong>在cdh066节点上进行操作</strong><br>mkdir /opt/software/cloudera-repos<br>将下载的所有文件通过FileZilla上传到/opt/software/cloudera-repos目录，目录结构如下:<br>├── allkeys.asc<br>├── cloudera-manager-daemons-6.3.1-1466458.el7.x86_64.rpm<br>├── cloudera-manager-agent-6.3.1-1466458.el7.x86_64.rpm<br>├── cloudera-manager-server-db-2-6.3.1-1466458.el7.x86_64.rpm<br>├── enterprise-debuginfo-6.3.1-1466458.el7.x86_64.rpm<br>└── cloudera-manager-server-6.3.1-1466458.el7.x86_64.rpm</p>
<p>CDH066节点执行如下命令  目的是建立本地存储库 搭建本地源  为了节省空间，也可以只在一台机器上搭建源</p>
<pre><code class="shell"> cd /opt/software/cloudera-repos  
 createrepo .

 # 将cloudera-repos目录移动到httpd的html目录下 制作本地源
 cd ..
 mv cloudera-repos /var/www/html/

 cd /etc/yum.repos.d
 touch cloudera-manager.repo  
 vim cloudera-manager.repo  添加如下 baseurl地址对应自己的主机host 如 cdh067节点:http://cdh067/cloudera-repos/  
[cloudera-manager]
name=Cloudera Manager 6.3.1
baseurl=http://cdh066/cloudera-repos/   
gpgcheck=0
enabled=1
autorefresh=0
type=rpm-md

 yum clean all 
 yum makecache</code></pre>
<p>制作本地源后<a target="_blank" rel="noopener" href="http://cdh066/cloudera-repos/">http://cdh066/cloudera-repos/</a>这个链接可以访问到源的文件<br>我们搭建的本地源，后面会用到<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-14.jpg" alt="alt CDH-14">  </p>
<p>安装Cloudera Manager组件:  </p>
<pre><code class="shell"># 在CDH066节点运行
 yum install cloudera-manager-daemons cloudera-manager-agent cloudera-manager-server --skip-broken --nogpgcheck</code></pre>
<p>下载parcel包，：<a target="_blank" rel="noopener" href="https://archive.cloudera.com/cdh6/6.3.1/parcels/">Index of cdh6/6.3.1/parcels/</a><br>该链接目前需要有License的Cloudera帐号才可以下载了。</p>
<pre><code class="shell">cd /opt/cloudera/parcel-repo
sha1sum CDH-6.3.1-1.cdh6.3.1.p0.1470567-el7.parcel | awk &#39;&#123; print $1 &#125;&#39; &gt;CDH-6.3.1-1.cdh6.3.1.p0.1470567-el7.parcel.sha
chown -R cloudera-scm:cloudera-scm /opt/cloudera/parcel-repo/*</code></pre>
<p>初始化数据库<br>该步骤很重要，可以在第一次启动ClouderaManager前检测数据库连接是否有问题，是否会影响到CMServer初始化。<br>通过该脚本输出的日志可以定位到错误原因，并修改mysql中不合理的配置文件，修改系统环境配置错误的地方。</p>
<pre><code class="shell"># （scm_prepare_database.sh 库类型 scm库名称 scm库连接的用户名 密码 -h服务端所在地址）
/opt/cloudera/cm/schema/scm_prepare_database.sh mysql scm scm 123456 -hHOST  </code></pre>
<p>systemctl start cloudera-scm-server.service    # 启动CM服务<br>systemctl status cloudera-scm-server.service   # 查看启动状态<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-15.jpg" alt="alt CDH-15">  </p>
<p>等待几分钟后访问<strong><a target="_blank" rel="noopener" href="http://cdh066:7180/">http://cdh066:7180</a></strong>，默认帐号密码都是<strong>admin</strong><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-16.jpg" alt="alt CDH-16">  </p>
<p>这里选择免费版本<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-17.jpg" alt="alt CDH-17">  </p>
<p>下面就是群集安装的步骤：<br>主机名称填写cdh066,cdh067,cdh068,cdh069，然后点击搜索搜索<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-18.JPG" alt="alt CDH-18"><br>这里搜到了67，68，69节点，但是66节点是灰色的，安装时，66节点不会被安装Agent，意味着后续安装的组件只能部署在67，68，69节点上运行，不过没有关系，可以在添加组件的步骤之前新开个页面将cdh066也加进去。  </p>
<p>这步使用我们搭建的本地源 <strong><a target="_blank" rel="noopener" href="http://cdh066/cloudera-repos/">http://cdh066/cloudera-repos/</a></strong>  如下设置<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-19.JPG" alt="alt CDH-19"><br>若继续按钮仍为灰色，可以点击更多选项，将所有外部源的链接全部删掉，增加本地parcel源地址，保存更改。</p>
<p>这步<strong>不要勾选</strong><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-20.JPG" alt="alt CDH-20">  </p>
<p>填入root用户的密码<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-21.JPG" alt="alt CDH-21">  </p>
<p>这步耐心等待，<strong>不要手动刷新</strong><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-22.JPG" alt="alt CDH-22">  </p>
<p><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-22.25.JPG" alt="alt CDH-22.25">  </p>
<p>这步勾选最后一项<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-22.3.JPG" alt="alt CDH-22.3"><br>企业安装时，最好先Inspect Hosts，验证节点是否有配置不当的地方，避免影响稳定性。针对Inspect Hosts的结果，可以一条一条优化集群配置。</p>
<p>开始安装服务 如图，选<strong>自定义服务</strong><br>根据集群环境和需求选择合适的服务和搭配。<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-22.4.JPG" alt="alt CDH-22.4"><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-22.5.JPG" alt="alt CDH-22.5">   </p>
<p>填上之前建的数据库，选的服务不同要求也不同<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-22.6.JPG" alt="alt CDH-22.6">  </p>
<p>最后部署成功，启动服务：<br>因为我虚拟机搭建，物理机本身配置就很差，有内存不足和请求延迟高的问题，所以，虽然服务都能正常打开，跑一两个小的计算任务也还能勉强承受，但CDH都会报警告，大多都是提示分配内存低了，请求延迟高了，内存不足等信息。<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-24.JPG" alt="alt CDH-24"><br>后续文章更新内容采用新电脑64GB内存i7-9750h物理机环境，能正常运行CDH服务：<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-31.JPG" alt="alt CDH-31">  </p>
<p>ClockOffset的报警：<br>集群全红，提示ClockOffset 未检测到ntpd服务。这个时候就需要配置NTP时间同步服务，请参考：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_39158271/article/details/80207291">集群NTP服务配置</a> 中的 <strong>配置内网NTP-Clients</strong> 部分。</p>
<h3 id="五-Flink集成"><a href="#五-Flink集成" class="headerlink" title="五.Flink集成"></a>五.Flink集成</h3><p>集成官方Flink-1.9.0到CDH管理<br>下载相应的csd文件和parcels文件到本地：<br><a target="_blank" rel="noopener" href="https://archive.cloudera.com/csa/1.0.0.0/csd/">csd下载地址</a><br><a target="_blank" rel="noopener" href="https://archive.cloudera.com/csa/1.0.0.0/parcels/">parcels下载地址</a><br>下载后得到如下：</p>
<pre><code class="text">FLINK-1.9.0-csa1.0.0.0-cdh6.3.0.jar
FLINK-1.9.0-csa1.0.0.0-cdh6.3.0-el7.parcel.sha
FLINK-1.9.0-csa1.0.0.0-cdh6.3.0-el7.parcel 
manifest.json</code></pre>
<p>将FLINK-1.9.0-csa1.0.0.0-cdh6.3.0.jar放入/opt/cloudera/csd中<br>将FLINK-1.9.0-csa1.0.0.0-cdh6.3.0-el7.parcel和FLINK-1.9.0-csa1.0.0.0-cdh6.3.0-el7.parcel.sha放入/opt/cloudera/parcel-repo中<br>然后重启Cloudera Manager Server服务：sudo systemctl restart cloudera-scm-server<br>重启完成后进入页面，主机-&gt;Parcel-&gt;检查新Parcel-&gt;找到Flink-&gt;分配<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-27.JPG" alt="alt CDH-27"><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-26.JPG" alt="alt CDH-26"><br>完成分配后开始添加服务：<br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-28.JPG" alt="alt CDH-28"><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-29.JPG" alt="alt CDH-29"><br><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/CDH/CDH-30.JPG" alt="alt CDH-30"><br>好啦，Flink可以使用啦。</p>
<h3 id="六-功能扩展"><a href="#六-功能扩展" class="headerlink" title="六.功能扩展"></a>六.功能扩展</h3><p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1544865">自定义告警脚本</a></p>
<h3 id="七-坑点总结"><a href="#七-坑点总结" class="headerlink" title="七.坑点总结"></a>七.坑点总结</h3><ol>
<li><p>如果遇到HDFS无法启动的问题，可能是因为**/dfs/nn/<strong>,</strong>/dfs/dn/<strong>,</strong>/dfs/snn/<strong>这些目录和里面的文件权限不够，请检查每个节点的这几个目录，保证nn,dn,snn文件夹权限为</strong>drwx—— 3 hdfs hadoop<strong>，即hdfs用户hadoop组，里面的current文件夹的权限为</strong>drwxr-xr-x 3 hdfs hdfs**。  </p>
</li>
<li><p>提示<strong>Error: JAVA_HOME is not set and Java could not be found</strong>  先确保JDK安装路径在/usr/java/jdkxxxxx，再确定JAVA版本是当前CDH支持的JAVA版本，过高过低都不会兼容，就报这个错误。  </p>
</li>
<li><p>The number of live datanodes 2 has reached the minimum number 0. Safe mode will be turned off automatically once the thresholds have been reached.   不多说，关闭安全模式 hdfs dfsadmin -safemode leave 注意，需要sudo到hdfs用户操作  如果sudo到hdfs失败，就vim /etc/passwd  将hdfs用户对应的/sbin/nologin改成/bin/bash 即可sudo到hdfs  </p>
</li>
<li><p>启动ClouderaManagerServer报错</p>
<pre><code class="text">INFO main:com.cloudera.server.cmf.bootstrap.EntityManagerFactoryBean: MYSQL database engine and table mapping: &#123;InnoDB=[AUDITS, COMMANDS, CONFIGS, SCHEMA_VERSION]&#125;
2020-03-25 16:27:22,021 WARN main:com.cloudera.server.cmf.bootstrap.EntityManagerFactoryBean: Failed to determine prior version. This is expected if you are starting Cloudera Manager for the first time. Please also ignore any error messages about missing tables. Moving ahead assuming no upgrade: org.hibernate.exception.SQLGrammarException: could not extract ResultSet
2020-03-25 16:27:22,031 INFO main:com.cloudera.enterprise.dbutil.DbUtil: Schema version table already exists.
2020-03-25 16:27:22,032 INFO main:com.cloudera.enterprise.dbutil.DbUtil: DB Schema version 1.
2020-03-25 16:27:22,039 WARN main:org.springframework.context.support.GenericApplicationContext: Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;com.cloudera.server.cmf.TrialState&#39;: Cannot resolve reference to bean &#39;entityManagerFactoryBean&#39; while setting constructor argument; nested exception is org.springframework.beans.factory.BeanCreationException: Error creating bean with name &#39;entityManagerFactoryBean&#39;: FactoryBean threw exception on object creation; nested exception is java.lang.RuntimeException: Unable to obtain CM release version.
2020-03-25 16:27:22,040 ERROR main:com.cloudera.server.cmf.Main: Server failed.</code></pre>
<p>使用/opt/cloudera/cm/schema/scm_prepare_database.sh工具初始化scm数据库时报错：when @@GLOBAL.ENFORCE_GTID_CONSISTENCY = 1<br>原因是数据库启用了gtid_mode，my.cnf有如下配置</p>
<pre><code class="text">gtid_mode = on
enforce_gtid_consistency = 1
binlog_gtid_simple_recovery = 1</code></pre>
<p>解决：<br>①注释掉如上配置，重启mysql server，②删掉scm库并重建，③重启cloudera-scm-server 即可</p>
</li>
<li><p>向CM添加host时，只有某几台主机可以被识别，其他主机，能显示出来但是灰色的，提示无法解析主机名称<br>解决：检查/etc/hosts 配置是否正确</p>
</li>
</ol>
<h3 id="HDFS高可用"><a href="#HDFS高可用" class="headerlink" title="HDFS高可用"></a>HDFS高可用</h3><p>进入HDFS角色，操作-&gt;启用High Availability-&gt;选择两个NN、三个JN节点，下一步（注意需要格式化NN，重启HDFS相关所有正在运行的依赖服务，重新部署客户端配置）-&gt;完成<br>进入HUE 将“Web界面角色”改为httpfs<br>关闭Hive，备份HiveMetastore数据库的数据（以防万一），操作-&gt;更新Hive Metastore NameNodes-&gt;重启Hive服务</p>
<h3 id="升级Python版本为3-8"><a href="#升级Python版本为3-8" class="headerlink" title="升级Python版本为3.8"></a>升级Python版本为3.8</h3><pre><code class="shell">cd /opt/software
wget https://www.python.org/ftp/python/3.8.5/Python-3.8.5.tgz
tar -zxvf Python-3.8.5.tgz
xsync或scp -r Python-3.8.5拷贝到其他节点，并对所有节点如下操作
cd Python-3.8.5
yum update -y
yum groupinstall -y &#39;Development Tools&#39;
yum install -y gcc openssl-devel bzip2-devel libffi-devel
./configure prefix=/usr/local/python3
make &amp;&amp; make install
ls -la /usr/bin/python*
vim /usr/bin/yum  #!/usr/bin/python 改为 #!/usr/bin/python2
vim /usr/libexec/urlgrabber-ext-down  #!/usr/bin/python 改为 #!/usr/bin/python2
mv /usr/bin/python /usr/bin/python_bak
ln -s /usr/local/python3/bin/python3.8 /usr/bin/python
ln -s /usr/local/python3/bin/python3.8 /usr/bin/python3
mv /usr/bin/pip /usr/bin/pip_bak
ln -s /usr/local/python3/bin/pip3.8 /usr/bin/pip3
python -V &amp;&amp; pip3 -V
---------------后续操作----------------
/usr/local/python3/bin/python3.8 -m pip install --upgrade pip -i https://pypi.doubanio.com/simple
pip3 install pyspark -i https://pypi.doubanio.com/simple
spark-env增加export PYSPARK_PYTHON=/usr/local/python3/bin/python3.8
pip3 install koalas -i https://pypi.doubanio.com/simple</code></pre>
<h3 id="HiveMetastoreServer异常解决"><a href="#HiveMetastoreServer异常解决" class="headerlink" title="HiveMetastoreServer异常解决"></a>HiveMetastoreServer异常解决</h3><p>去HMS机器找/var/log/hive看到如下Error日志：<br>Failed to sync requested HMS notifications up to the event ID xxxxx<br>查看sentry 异常CounterWait源码发现传递的id比 currentid 大导致一直等待超时，超时时间为200s。<br>CDH可以启用Sentry同步ACL权限，启动后HDFS、Sentry、HMS三者间权限同步的消息处理，突然大批量的目录权限消息需要处理，后台线程处理不过来，消息积压就会报Failed to sync requested HMS notifications up to the event ID: xxxxx，该错误不会导致HMS不可用但会导致响应速度很慢。<br>解决：</p>
<ol>
<li>sentry_hms_notification_id表插入最大的ID，重启Sentry忽略掉之前积压的消息</li>
<li>设置Sentry参数sentry.notification.sync.timeout.ms（默认200s）参数调小超时时间，减小等待时间，积压不多的话可以让它自行消费处理掉</li>
</ol>
<h3 id="CDH添加外部HDFS集群的nameservice"><a href="#CDH添加外部HDFS集群的nameservice" class="headerlink" title="CDH添加外部HDFS集群的nameservice"></a>CDH添加外部HDFS集群的nameservice</h3><p>现在添加对外部HDFS集群nameservice-test的支持。<br>在配置项hdfs-site.xml 的 HDFS 客户端高级配置代码段（安全阀）中添加配置</p>
<pre><code class="xml">&lt;property&gt;
    &lt;name&gt;dfs.nameservices&lt;/name&gt;
    &lt;value&gt;nameservice-dev,nameservice-test&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.ha.namenodes.nameservice-test&lt;/name&gt;
    &lt;value&gt;nn1,nn2&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.namenode.rpc-address.nameservice-test.nn1&lt;/name&gt;
    &lt;value&gt;test1:8020&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.namenode.rpc-address.nameservice-test.nn2&lt;/name&gt;
    &lt;value&gt;test2:8020&lt;/value&gt;
&lt;/property&gt;
&lt;property&gt;
    &lt;name&gt;dfs.client.failover.proxy.provider.nameservice-test&lt;/name&gt;
    &lt;value&gt;org.apache.hadoop.hdfs.server.namenode.ha.ConfiguredFailoverProxyProvider&lt;/value&gt;
&lt;/property&gt;</code></pre>
<h3 id="impala-shell脚本报错"><a href="#impala-shell脚本报错" class="headerlink" title="impala-shell脚本报错"></a>impala-shell脚本报错</h3><p>升级Python版本后，Impala-shell报语法错误<br>原python命令是python2.7，现python命令是python3.8，而/opt/cloudera/parcels/CDH-6.3.1-1.cdh6.3.1.p0.1470567/bin/impala-shell脚本没考虑环境变量，直接用python命令执行，故出现语法兼容性问题。<br>解决：vim /opt/cloudera/parcels/CDH-6.3.1-1.cdh6.3.1.p0.1470567/bin/impala-shell<br>将最后一行exec python…替换为exec python2.7</p>
<pre><code class="python">PYTHONPATH=&quot;$&#123;EGG_PATH&#125;$&#123;SHELL_HOME&#125;/gen-py:$&#123;SHELL_HOME&#125;/lib:$&#123;PYTHONPATH&#125;&quot; \
  exec python2.7 $&#123;SHELL_HOME&#125;/impala_shell.py &quot;$@&quot;</code></pre>
<h3 id="beeline连接Impala"><a href="#beeline连接Impala" class="headerlink" title="beeline连接Impala"></a>beeline连接Impala</h3><p>1.拷贝ImpalaJDBC41.jar到/opt/cloudera/parcels/CDH-6.3.1-1.cdh6.3.1.p0.1470567/lib/hive/auxlib<br>2.beeline -d “com.cloudera.impala.jdbc41.Driver” -u “jdbc:impala://one_impalad_ip:21050”<br>3.如果报warn：Error: [Simba]<a href="11975">JDBC</a> Unsupported transaction isolation level: 4. (state=HY000,code=11975) 则加beeline参数–isolation=default </p>
<h2 id="Cloudera-Manager使用"><a href="#Cloudera-Manager使用" class="headerlink" title="Cloudera Manager使用"></a>Cloudera Manager使用</h2><p><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/BlogImages-0@master/cdn_sources/Blog_Images/CDH/CDH-usage-01.JPG" alt="alt CDH-usage-01">  </p>

        </div>
        <!-- .entry-content -->
        <div class="single-reward">
          <div class="reward-open">赏<div class="reward-main">
              <ul class="reward-row">
                <li class="alipay-code"><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/custom/donate/aliPayQR.jpg"></li>
                <li class="wechat-code"><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/custom/donate/weChatQR.png"></li>
              </ul>
            </div>
          </div>
        </div>
        <div style="text-align:center; width: 100%" class="social-share share-mobile" data-disabled="diandian, tencent"></div>
        <footer class="post-footer">
          <div class="post-lincenses"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="nofollow"><i class="fa fa-creative-commons" aria-hidden="true"></i> 知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a></div>
          <div class="post-tags">
          </div>
          <div class="post-share">
            <div class="social-share sharehidden share-component"></div>
            <i class="iconfont show-share icon-forward"></i>
          </div>
        </footer><!-- .entry-footer -->
      </article>
      <!-- #post-## -->
      <div class="toc" style="background: none;"></div>
      <section class="post-squares nextprev">
        
          
            <div class="post-nepre half previous">
          
            <a href="/26078/" rel="prev">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/Sqoop/Sqoop-0.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/Sqoop/Sqoop-0.jpg">
              </div>
              <span class="label">
              Previous Post</span>
              <div class="info">
                <h3>
                Sqoop学习笔记</h3>
                <hr>
              </div>
            </a>
          </div>
        
        
          
            <div class="post-nepre half next">
          
            <a href="/39595/" rel="next">
              <div class="background">
                <img class="lazyload" src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/loader/orange.progress-bar-stripe-loader.svg" data-src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/QCon/QCon-1.jpg" style="width: 100%; height: 100%; object-fit: cover; pointer-events: none;" onerror="imgError(this,3)" src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/Blog_Images/QCon/QCon-1.jpg">
              </div>
              <span class="label">
              Next Post</span>
              <div class="info">
                <h3>
                记一次参加QCon全球软件开发大会</h3>
                <hr>
              </div>
            </a>
          </div>
        
      </section>
      
<div id="vcomments"></div>
<script>
  window.onload = function(){
      var valine = new Valine();
      valine.init({
        el: '#vcomments',
        appId: "zUyVEaHo59RUUwiPTChPEeBj-gzGzoHsz",
        appKey: "xIEyTcrkTuJLz6ewPbpTj8mz",
        path: window.location.pathname,
        placeholder: "缘分使我们相遇！留下足迹吧..."
      })
  }
</script>

      <section class="author-profile">
        <div class="info" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
          <a href="/" class="profile gravatar"><img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/custom/avatar.jpg" itemprop="image" alt="佳境" height="70" width="70"></a>
          <div class="meta">
            <span class="title">Author</span>
            <h3 itemprop="name">
            <a href="/" itemprop="url" rel="author">佳境</a>
            </h3>
          </div>
        </div>
        <hr>
        <p><i class="iconfont icon-write"></i>你自以为的极限，只是别人的起点</p>
      </section>
    </main><!-- #main -->
  </div><!-- #primary -->
</div>



    </div>    
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="请输入关键词..."/>
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            // PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
    <!-- <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 佳境Shmily<br>
      powered_by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer> -->
<footer id="colophon" class="site-footer" role="contentinfo">
  <div class="site-info">
    <div class="footertext">
      <div class="img-preload">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/wordpress-rotating-ball-o.svg">
        <img src="https://cdn.jsdelivr.net/gh/honjun/cdn@1.6/img/other/disqus-preloader.svg">
      </div>
      <p style="color: #666666;">&copy 2020</p>
    </div>
    <div class="footer-device">
    <p style="font-family: 'Ubuntu', sans-serif;">
        <span style="color: #b9b9b9;">Powered by <a href="https://hexo.io/zh-cn/" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hexo</a> <i class="iconfont icon-sakura rotating" style="color: #ffc0cb;display:inline-block"></i> 佳境Shmily</a>  <!-- &<a href="shmily-qjj.top" target="_blank" style="color: #b9b9b9;;text-decoration: underline dotted rgba(0, 0, 0, .1);">Hojun</a> -->
        </span>
      </p>
    </div>
  </div><!-- .site-info -->
</footer>



<!-- <script src="/js/tocbot.js"></script> -->
<script type="text/javascript" src="/js/lib.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script type="text/javascript" src="/js/InsightSearch.js"></script>
<script type="text/javascript" src="/js/jquery.fancybox.min.js"></script>
<script type="text/javascript" src="/js/zoom.min.js"></script>
<script type="text/javascript" src="/js/sakura-app.js"></script>
<script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
<script src='//unpkg.com/valine@1.3.4/dist/Valine.min.js'></script>
<script src="/js/botui.js"></script>
<!-- 不蒜子 网页计数器 -->
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script> -->
<script type="text/javascript">
/* <![CDATA[ */
if (/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  var Poi = {"pjax":"1","movies":{"url": "http://pyp1a3dme.bkt.clouddn.com/","name":"blog-my_heart_will_go_on.mp4,blog-big_fish.mp4,blog_sakura.mp4,videoblog-metro.mp4,videoblog-xxdsx.mp4","live":"close"},"windowheight":"fixed","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
} else {
  var Poi = {"pjax":"1","movies":{"url": "http://pyp1a3dme.bkt.clouddn.com/","name":"blog-my_heart_will_go_on.mp4,blog-big_fish.mp4,blog_sakura.mp4,videoblog-metro.mp4,videoblog-xxdsx.mp4","live":"open"},"windowheight":"auto","codelamp":"close","ajaxurl":"","order":"asc","formpostion":"bottom"};
}
/* ]]> */

</script>
<script>
$(document).ready(function() {
  if ($(".toc").length > 0 && document.body.clientWidth > 1200) {
    if ($(".pattern-center").length > 0) { //有图的情况
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -400,
          scrollSmoothOffset: -85
      });
    } else {
      tocbot.init({
          // Where to render the table of contents.
          tocSelector: '.toc', // 放置目录的容器
          // Where to grab the headings to build the table of contents.
          contentSelector: '.entry-content', // 正文内容所在
          // Which headings to grab inside of the contentSelector element.
          scrollSmooth: true,
          headingSelector: 'h1, h2, h3, h4, h5', // 需要索引的标题级别
          headingsOffset: -85,
          scrollSmoothOffset: -85
      });
    }
    var offsetTop = $('.toc').offset().top - 95;
    window.onscroll = function() {
      var scrollTop = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop;
      if (scrollTop >= offsetTop) {
        $('.toc').addClass('toc-fixed');
      } else {
        $('.toc').removeClass('toc-fixed');
      }
    }
  }
});
</script>

    <div class="openNav no-select" style="height: 50px;">
      <div class="iconflat no-select" style="width: 50px; height: 50px;">
        <div class="icon"></div>
      </div>
      <div class="site-branding search-form-submit">
        <i class="iconfont js-toggle-search iconsearch icon-search"></i>
      </div>
    </div>
  </section>
  <div id="mo-nav" class="">
  <div class="m-avatar">
    <img src="https://cdn.jsdelivr.net/gh/Shmilyqjj/Shmily-Web@master/cdn_sources/img/custom/avatar.jpg">
  </div>
  <p style="text-align: center; color: #333; font-weight: 900; font-family: 'Ubuntu', sans-serif; letter-spacing: 1.5px">佳境Shmily</p>
  <p style="text-align: center; word-spacing: 20px;">
    
      
        <a href="https://github.com/Shmilyqjj" class="fa fa-github" target="_blank" style="color: #333; margin-left:20px"></a>
      
        <a href="http://music.163.com/artist?id=13610347&userid=318926152" class="fa fa-weibo" target="_blank" style="color: #dd4b39; margin-left:20px"></a>
      
        <a href="https://wpa.qq.com/msgrd?v=3&uin=710552907&site=qq&menu=yes" class="fa fa-qq" target="_blank" style="color: #25c6fe; margin-left:20px"></a>
      
    
  </p>
  <ul id="menu-new-1" class="menu">
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-fort-awesome faa-shake" aria-hidden="true"></i>
            首页
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/archives">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-archive faa-shake" aria-hidden="true"></i>
            归档
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/categories/%E6%8A%80%E6%9C%AF/">
                  <i class="fa fa-code" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/categories/%E7%94%9F%E6%B4%BB/">
                  <i class="fa fa-file-text-o" aria-hidden="true"></i>
                  生活
                </a>
              </li>
            
              <li>
                <a href="/categories/%E9%9F%B3%E4%B9%90/">
                  <i class="fa fa-music" aria-hidden="true"></i>
                  音乐
                </a>
              </li>
            
              <li>
                <a href="/categories/%E9%9A%8F%E6%83%B3/">
                  <i class="fa fa-commenting-o" aria-hidden="true"></i>
                  随想
                </a>
              </li>
            
              <li>
                <a href="/categories/%E5%85%B6%E4%BB%96/">
                  <i class="fa fa-book" aria-hidden="true"></i>
                  其他
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="javascript:;">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-list-ul faa-vertical" aria-hidden="true"></i>
            清单
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/bangumi/">
                  <i class="fa fa-film faa-vertical" aria-hidden="true"></i>
                  看剧
                </a>
              </li>
            
              <li>
                <a href="/tags/">
                  <i class="fa fa-th-list faa-bounce" aria-hidden="true"></i>
                  书单
                </a>
              </li>
            
              <li>
                <a href="/music/">
                  <i class="fa fa-headphones" aria-hidden="true"></i>
                  歌单
                </a>
              </li>
            
              <li>
                <a href="/album/">
                  <i class="fa fa-photo" aria-hidden="true"></i>
                  相册
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/comment/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-pencil-square-o faa-tada" aria-hidden="true"></i>
            留言板
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/links/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-link faa-shake" aria-hidden="true"></i>
            博友圈
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/donate/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-heart faa-pulse" aria-hidden="true"></i>
            赞赏
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-leaf faa-wrench" aria-hidden="true"></i>
            关于
          </span>
        </a>
        
          <ul class="sub-menu">
            
              <li>
                <a href="/about/">
                  <i class="fa fa-meetup" aria-hidden="true"></i>
                  我？
                </a>
              </li>
            
              <li>
                <a target="_blank" rel="noopener" href="https://tech.shmily-qjj.top/">
                  <i class="fa iconfont icon-sakura" aria-hidden="true"></i>
                  技术
                </a>
              </li>
            
              <li>
                <a href="/lab/">
                  <i class="fa fa-cogs" aria-hidden="true"></i>
                  Lab
                </a>
              </li>
            
          </ul>
        
      </li>
    
      <li>
        <a href="/client/">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-android faa-vertical" aria-hidden="true"></i>
            客户端
          </span>
        </a>
        
      </li>
    
      <li>
        <a href="/atom.xml">
          <span class="faa-parent animated-hover">
            <i class="fa  fa-rss faa-pulse" aria-hidden="true"></i>
            RSS
          </span>
        </a>
        
      </li>
    
  </ul>
  <p style="text-align: center; font-size: 13px; color: #b9b9b9;">&copy 2020 hexo-sakura</p>
</div>
<button onclick="topFunction()" class="mobile-cd-top" id="moblieGoTop" title="Go to top" style="display: none;"><i class="fa fa-chevron-up" aria-hidden="true"></i></button>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>
<style>
  .aplayer .aplayer-lrc {
    height: 35px;
  }
  .aplayer .aplayer-lrc p{
    font-size: 16px;
    font-weight: 700;
    line-height: 18px !important;
  }
  .aplayer .aplayer-lrc p.aplayer-lrc-current{
    color: #FF1493;
  }
  .aplayer.aplayer-narrow .aplayer-body{
    left: -66px !important;
  }
  .aplayer.aplayer-fixed .aplayer-lrc {
    display: none;
  }
  .aplayer .aplayer-lrc.aplayer-lrc-hide {
      display:none !important;
  }
  .aplayer.aplayer-fixed .lrc-show {
    display: block;
    background: rgba(255, 255, 255, 0.8);
  }
</style>
<div class="aplayer"

    data-id="2368663800"

    data-server="netease"

    data-type="playlist"

    data-fixed="true"

    data-autoplay="false"

    data-loop="all"

    data-order="random"

    data-preload="auto"

    data-volume="0.7"

    data-mutex="true"

    data-mini="true"

</div>
<script src="https://cdn.jsdelivr.net/npm/meting@1.2/dist/Meting.min.js"></script>
<script>
  $(function(){
    $('body').on('click', '.aplayer', function(){
      if($('.aplayer-button').hasClass('aplayer-play')) {
        $('.aplayer-lrc').removeClass('lrc-show');
      } else {
        $('.aplayer-lrc').addClass('lrc-show');
      }
    })
  });
</script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/wanko.model.json"},"display":{"position":"relative","left":"30px","width":150,"height":256},"mobile":{"show":false},"log":false,"tagMode":false});</script></body>
</html>